datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
  schemas   = ["public"]
}

generator client {
  provider = "prisma-client-js"
}

// ? ENUMS
enum Role {
  ADMIN
  SISWA
  GURU
  ORANGTUA

  @@schema("public")
}

enum JenisKelamin {
  UNKNOWN
  MALE
  FEMALE

  @@schema("public")
}

enum GolonganDarah {
  UNKNOWN
  A
  B
  AB
  O

  @@schema("public")
}

enum Kewarganegaraan {
  UNKNOWN
  INDONESIA
  FOREIGN

  @@schema("public")
}

enum SemesterAjaranUrutan {
  SATU
  DUA

  @@schema("public")
}

// ? =====

// ? TABLES
model Akun {
  id                                 String                               @id @default(cuid())
  // ? credentials
  username                           String                               @unique
  password                           String
  role                               Role                                 @default(SISWA)
  nip                                String?
  // ? general
  displayName                        String?
  firstName                          String
  lastName                           String
  email                              String?
  tanggalLahir                       DateTime?
  tempatLahir                        String?
  jenisKelamin                       JenisKelamin                         @default(UNKNOWN)
  alamat                             String?
  agama                              String?
  golonganDarah                      GolonganDarah                        @default(UNKNOWN)
  kewarganegaraan                    Kewarganegaraan                      @default(UNKNOWN)
  point                              Int                                  @default(0)
  // ? meta data
  updatedAt                          DateTime                             @default(now())
  createdAt                          DateTime                             @default(now())
  deletedAt                          DateTime?
  createdById                        String?
  createdBy                          Akun?                                @relation(fields: [createdById], references: [id], name: "createdBy")
  lastUpdateById                     String?
  lastUpdateBy                       Akun?                                @relation(fields: [lastUpdateById], references: [id], name: "lastUpdateBy")
  // ? action relations
  akunCreator                        Akun[]                               @relation(name: "createdBy")
  akunUpdator                        Akun[]                               @relation(name: "lastUpdateBy")
  tempAkunCreator                    TempAkun[]                           @relation(name: "createdBy")
  tahunAjaranCreator                 TahunAjaran[]                        @relation(name: "createdBy")
  tahunAjaranUpdator                 TahunAjaran[]                        @relation(name: "lastUpdateBy")
  semesterAjaranCreator              SemesterAjaran[]                     @relation(name: "createdBy")
  semesterAjaranUpdator              SemesterAjaran[]                     @relation(name: "lastUpdateBy")
  kelasCreator                       Kelas[]                              @relation(name: "createdBy")
  kelasUpdator                       Kelas[]                              @relation(name: "lastUpdateBy")
  mataPelajaranCreator               MataPelajaran[]                      @relation(name: "createdBy")
  mataPelajaranUpdator               MataPelajaran[]                      @relation(name: "lastUpdateBy")
  ekstrakulikulerCreator             Ekstrakulikuler[]                    @relation(name: "createdBy")
  ekstrakulikulerUpdator             Ekstrakulikuler[]                    @relation(name: "lastUpdateBy")
  pengumumanCreator                  Pengumuman[]                         @relation(name: "createdBy")
  pengumumanUpdator                  Pengumuman[]                         @relation(name: "lastUpdateBy")
  // ? relations
  siswaPerKelasDanSemester           SiswaPerKelasDanSemester[]
  waliKelas                          Kelas[]                              @relation(name: "wali")
  guruMataPelajaran                  MataPelajaran[]
  pengajarEkstrakulikuler            Ekstrakulikuler[]                    @relation(name: "pengajar")
  siswaPerEkstrakulikulerDanSemester SiswaPerEkstrakulikulerDanSemester[]

  @@schema("public")
}

model TempAkun {
  id              String          @id @default(cuid())
  username        String
  password        String
  role            Role            @default(SISWA)
  displayName     String?
  firstName       String
  lastName        String
  email           String?
  tanggalLahir    DateTime?
  tempatLahir     String?
  jenisKelamin    JenisKelamin    @default(UNKNOWN)
  alamat          String?
  agama           String?
  golonganDarah   GolonganDarah   @default(UNKNOWN)
  kewarganegaraan Kewarganegaraan @default(UNKNOWN)
  // ? meta data
  createdAt       DateTime        @default(now())
  createdById     String?
  createdBy       Akun?           @relation(fields: [createdById], references: [id], name: "createdBy")

  @@schema("public")
}

model Hour {
  id               String            @id
  // ? credentials
  sequenceNumber   Int               @default(autoincrement())
  label            String
  // ? relations
  jadwalPelajarans JadwalPelajaran[]

  @@schema("public")
}

model Days {
  id               String            @id
  // ? credentials
  sequenceNumber   Int               @default(autoincrement())
  label            String
  // ? relations
  jadwalPelajarans JadwalPelajaran[]

  @@schema("public")
}

model TahunAjaran {
  id              String            @id @default(cuid())
  // ? credentials
  nama            String            @unique
  tahunMulai      DateTime
  tahunBerakhir   DateTime
  // ? meta data
  updatedAt       DateTime          @default(now())
  createdAt       DateTime          @default(now())
  deletedAt       DateTime?
  createdById     String?
  createdBy       Akun?             @relation(fields: [createdById], references: [id], name: "createdBy")
  lastUpdateById  String?
  lastUpdateBy    Akun?             @relation(fields: [lastUpdateById], references: [id], name: "lastUpdateBy")
  // ? relations
  semesterAjaran  SemesterAjaran[]
  kelas           Kelas[]
  ekstrakulikuler Ekstrakulikuler[]

  @@schema("public")
}

model SemesterAjaran {
  id                                 String                               @id @default(cuid())
  // ? credentials
  urutan                             SemesterAjaranUrutan                 @default(SATU)
  // ? foreign
  tahunAjaranId                      String
  tahunAjaran                        TahunAjaran                          @relation(fields: [tahunAjaranId], references: [id])
  // ? meta data
  updatedAt                          DateTime                             @default(now())
  createdAt                          DateTime                             @default(now())
  deletedAt                          DateTime?
  createdById                        String?
  createdBy                          Akun?                                @relation(fields: [createdById], references: [id], name: "createdBy")
  lastUpdateById                     String?
  lastUpdateBy                       Akun?                                @relation(fields: [lastUpdateById], references: [id], name: "lastUpdateBy")
  // ? relations
  mataPelajaran                      MataPelajaran[]
  siswaPerKelasDanSemester           SiswaPerKelasDanSemester[]
  siswaPerEkstrakulikulerDanSemester SiswaPerEkstrakulikulerDanSemester[]
  jadwalPelajarans                   JadwalPelajaran[]

  @@schema("public")
}

model Kelas {
  id                       String                     @id @default(cuid())
  // ? credentials
  nama                     String
  // ? foreign
  tahunAjaranId            String
  tahunAjaran              TahunAjaran                @relation(fields: [tahunAjaranId], references: [id])
  waliId                   String?
  wali                     Akun?                      @relation(fields: [waliId], references: [id], name: "wali")
  // ? meta data
  updatedAt                DateTime                   @default(now())
  createdAt                DateTime                   @default(now())
  deletedAt                DateTime?
  createdById              String?
  createdBy                Akun?                      @relation(fields: [createdById], references: [id], name: "createdBy")
  lastUpdateById           String?
  lastUpdateBy             Akun?                      @relation(fields: [lastUpdateById], references: [id], name: "lastUpdateBy")
  // ? relations
  siswaPerKelasDanSemester SiswaPerKelasDanSemester[]
  jadwalPelajarans         JadwalPelajaran[]

  @@schema("public")
}

model MataPelajaran {
  id               String            @id @default(cuid())
  // ? credentials
  nama             String
  // ? general
  jumlahSesi       Int               @default(1)
  // ? foreign
  guruId           String?
  guru             Akun?             @relation(fields: [guruId], references: [id])
  semesterAjaranId String
  semesterAjaran   SemesterAjaran    @relation(fields: [semesterAjaranId], references: [id])
  // ? meta data
  updatedAt        DateTime          @default(now())
  createdAt        DateTime          @default(now())
  deletedAt        DateTime?
  createdById      String?
  createdBy        Akun?             @relation(fields: [createdById], references: [id], name: "createdBy")
  lastUpdateById   String?
  lastUpdateBy     Akun?             @relation(fields: [lastUpdateById], references: [id], name: "lastUpdateBy")
  // ? relations
  jadwalPelajarans JadwalPelajaran[]

  @@schema("public")
}

model Ekstrakulikuler {
  id                                 String                               @id @default(cuid())
  // ? credentials
  nama                               String
  // ? general
  ruangan                            String?
  // ? foreign
  tahunAjaranId                      String
  tahunAjaran                        TahunAjaran                          @relation(fields: [tahunAjaranId], references: [id])
  pengajarId                         String?
  pengajar                           Akun?                                @relation(fields: [pengajarId], references: [id], name: "pengajar")
  // ? meta data
  updatedAt                          DateTime                             @default(now())
  createdAt                          DateTime                             @default(now())
  deletedAt                          DateTime?
  createdById                        String?
  createdBy                          Akun?                                @relation(fields: [createdById], references: [id], name: "createdBy")
  lastUpdateById                     String?
  lastUpdateBy                       Akun?                                @relation(fields: [lastUpdateById], references: [id], name: "lastUpdateBy")
  // ? relations
  siswaPerEkstrakulikulerDanSemester SiswaPerEkstrakulikulerDanSemester[]

  @@schema("public")
}

model Pengumuman {
  id             String    @id @default(cuid())
  // ? credentials
  nama           String
  // ? general
  content        String
  // ? meta data
  updatedAt      DateTime  @default(now())
  createdAt      DateTime  @default(now())
  deletedAt      DateTime?
  createdById    String?
  createdBy      Akun?     @relation(fields: [createdById], references: [id], name: "createdBy")
  lastUpdateById String?
  lastUpdateBy   Akun?     @relation(fields: [lastUpdateById], references: [id], name: "lastUpdateBy")

  @@schema("public")
}

// ? ======

// ? RELATIONS
model JadwalPelajaran {
  id               Int             @id @default(autoincrement())
  // ? identifier
  mataPelajaranId  String
  mataPelajaran    MataPelajaran   @relation(fields: [mataPelajaranId], references: [id])
  dayId            String
  day              Days            @relation(fields: [dayId], references: [id])
  hourId           String
  hour             Hour            @relation(fields: [hourId], references: [id])
  semesterAjaranId String?
  semesterAjaran   SemesterAjaran? @relation(fields: [semesterAjaranId], references: [id])
  // ? foreign
  kelasId          String
  kelas            Kelas           @relation(fields: [kelasId], references: [id])

  @@schema("public")
}

model SiswaPerKelasDanSemester {
  id               Int            @id @default(autoincrement())
  // ? foreign
  siswaId          String
  siswa            Akun           @relation(fields: [siswaId], references: [id])
  kelasId          String
  kelas            Kelas          @relation(fields: [kelasId], references: [id])
  semesterAjaranId String
  semesterAjaran   SemesterAjaran @relation(fields: [semesterAjaranId], references: [id])

  @@schema("public")
}

model SiswaPerEkstrakulikulerDanSemester {
  id                Int             @id @default(autoincrement())
  // ? foreign
  siswaId           String
  siswa             Akun            @relation(fields: [siswaId], references: [id])
  ekstrakulikulerId String
  ekstrakulikuler   Ekstrakulikuler @relation(fields: [ekstrakulikulerId], references: [id])
  semesterAjaranId  String
  semesterAjaran    SemesterAjaran  @relation(fields: [semesterAjaranId], references: [id])

  @@schema("public")
}

// ? =========
